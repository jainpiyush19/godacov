# godacov [![FOSSA Status](https://app.fossa.io/api/projects/git%2Bgithub.com%2Fschrej%2Fgodacov.svg?type=shield)](https://app.fossa.io/projects/git%2Bgithub.com%2Fschrej%2Fgodacov)


godacov is a command-line tool to publish test coverage reports generated with `go test -coverprofile=<filename>` to [Codacy](https://codacy.com).

## How to use
Install godacov using `go get`
```
$ go get github.com/schrej/godacov
```

Retrieve a project token from codacy from `Your Project > Settings > Integrations > Project API`.

Run your tests and generate the coverage report.
```

go test -coverprofile=coverage.out
```
If you have multiple Packages, have a look at [haya14busa/goverage](https://github.com/haya14busa/goverage). As a shortcut, this should work:
```
go get -u github.com/haya14busa/goverage
goverage -v -coverprofile=coverage.out ./...
```

Finally publish the results to Codacy using
```

godacov -t <project token> -r ./coverage.out -c <current commit id>
```

### Travis CI
If you are using Travis CI you should add your project token as a secret environment variable, then run the following command in your script. Remember that you have to append `-coverprofile=coverage.out` to your test command.
```
godacov -t $CODACY_TOKEN -r ./coverage.out -c $TRAVIS_COMMIT
```


## CLI Usage

```
Usage:
  godacov [flags]

Flags:
  -i, --allow-insecure    Allow insecure connection to base URL
  -a, --api-base string   The base URL of the codacy API server to use (default "https://api.codacy.com")
  -c, --commit string     The hash of the commit to provide coverage for
  -h, --help              help for godacov
  -r, --report string     coverage report file generated by 'go test'
  -t, --token string      Codacy project token
```


## License
[![FOSSA Status](https://app.fossa.io/api/projects/git%2Bgithub.com%2Fschrej%2Fgodacov.svg?type=large)](https://app.fossa.io/projects/git%2Bgithub.com%2Fschrej%2Fgodacov?ref=badge_large)
